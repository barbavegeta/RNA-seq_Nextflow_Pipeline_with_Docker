nextflow.enable.dsl=2

params {
  samplesheet  = null
  genome_fasta = null
  genome_gtf   = null
  outdir       = "results"
  threads      = 4
  design       = null
  skip_deseq2  = false
}

profiles {

  standard {
    docker {
      enabled = false
    }
  }

  docker {
    docker {
      enabled = true

      // Avoid permission issues locally; don't crash if 'id' isn't available
      runOptions = {
        try {
          def uid = ['id','-u'].execute().text.trim()
          def gid = ['id','-g'].execute().text.trim()
          return "--user ${uid}:${gid}"
        } catch (Exception e) {
          return ""
        }
      }.call()
    }
  }
}

process {
  withName:FASTQC         { container = 'rnaseq-tools:0.1.0' }
  withName:CUTADAPT       { container = 'rnaseq-tools:0.1.0' }
  withName:STAR_INDEX     { container = 'rnaseq-tools:0.1.0' }
  withName:STAR_ALIGN     { container = 'rnaseq-tools:0.1.0' }
  withName:SORT_INDEX_BAM { container = 'rnaseq-tools:0.1.0' }
  withName:FEATURECOUNTS  { container = 'rnaseq-tools:0.1.0' }
  withName:MULTIQC        { container = 'rnaseq-tools:0.1.0' }
  withName:DESEQ2         { container = 'rnaseq-r:0.1.0' }
}
